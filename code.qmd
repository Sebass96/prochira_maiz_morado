---
title: "ESTIMULANTES EN LA GERMINACIÓN Y BIOMETRÍA INICIAL DE DOS VARIEDADES DE MAÍZ MORADO (_Zea mays_ L.)"
format:
  html:
    toc: true
    toc-location: left
    number-sections: true
    self-contained: true
    output-file: "ESM_1"
editor_options: 
  chunk_output_type: console
execute: 
  warning: false
  echo: true
---

# Setup

Instalar version en desarrollo.

```{r}
#| eval: false

if (!require("remotes"))
  install.packages("remotes")
remotes::install_github("flavjack/inti")
```


```{r}
#| label:  setup

library(emmeans)
library(corrplot)
library(multcomp)
source('https://inkaverse.com/setup.r')

session_info()
```

# Refrencias

- (PCA) https://www.r-bloggers.com/2017/07/pca-course-using-factominer/
- (PCA) https://www.youtube.com/watch?v=Uhw-1NilmAk&ab_channel=Fran%C3%A7oisHusson
- (HCPC) https://youtu.be/EJqYTDTJJug

# Import data

> https://docs.google.com/spreadsheets/d/1E_l9uV3MT1qlJuVtWK66NgevqPH6fVJCekqNhS_VGm0/edit?gid=1893553741#gid=1893553741

```{r}
url <- "https://docs.google.com/spreadsheets/d/1E_l9uV3MT1qlJuVtWK66NgevqPH6fVJCekqNhS_VGm0/edit?gid=1893553741#gid=1893553741"

gs <- url %>% 
  as_sheets_id()

imbibition <- gs %>% 
  range_read("imbibition") %>% 
  rename_with(~ tolower(.)) %>% 
  mutate(time = tiempo, .after = tiempo) %>% 
  mutate(across(1:tiempo, ~ as.factor(.)))

str(imbibition)

germination <- gs %>% 
  range_read("germination") %>% 
  rename_with(~ tolower(.)) %>% 
  mutate(across(1:variedad, ~ as.factor(.)))

str(germination)

plantula <- gs %>% 
  range_read("plantula") %>% 
  rename_with(~ tolower(.)) %>% 
  mutate(across(1:variedad, ~ as.factor(.)))

str(plantula)
```

# Data summary

```{r}
sm <- imbibition %>% 
  group_by(tratamiento, variedad, tiempo) %>% 
  summarise(across(peso, ~ sum(!is.na(.))))

sm

sm <- germination %>% 
  group_by(tratamiento, variedad) %>% 
  summarise(across(pg:ig, ~ sum(!is.na(.))))

sm

sm <- plantula %>% 
  group_by(tratamiento, variedad) %>% 
  summarise(across(where(is.numeric), ~ sum(!is.na(.))))

sm
```

# Objetivos

(a) Evaluar los parámetros de germinación de dos variedades de semillas de maiz morado usando bioestimulante orgánico. 

(b) Identificar el mejor tratamiento que influye positivamente en el crecimiento y desarrollo de plantulas en el cultivo de Maíz morado.


## Objetivo Específico 1

> Evaluar los parámetros de germinación de dos variedades de semillas de maiz morado usando bioestimulante orgánico. 

- Imbibiciación, % germinación, velocidad e IG


### Imbibición

```{r}
trait <- "peso"
fb <- imbibition

lmm <- paste({{trait}}, "~ 1 + (1|bloque) + tratamiento*variedad +  (1 + tiempo|trat)") %>% as.formula()

lmd <- paste({{trait}}, "~ bloque + tiempo +  tratamiento*variedad") %>% as.formula()

rmout <- fb %>% 
  remove_outliers(formula = lmm
                  , drop_na = T, plot_diag = T)

rmout$diagplot

rmout$outliers

model <- rmout$data$clean %>% 
  aov(formula = lmd, .)

anova(model)

mc <- emmeans(model, ~ tiempo|variedad|tratamiento) %>%
  cld(Letters = letters, reversed = T) %>%
  mutate(across(.group, trimws)) %>% 
  rename(group = ".group")

mc %>% kable()

p1a <- mc %>% 
  plot_smr(type = "line"
           , x = "tiempo"
           , y = "emmean"
           , group = "variedad"
           , sig = "group"
           , error = "SE"
           , color = T
           , ylab = "Peso (g)"
           , xlab = "Tiempo (h)"
           , ylimits = c(0, 1, 0.2)
           ) + 
  facet_wrap(. ~ tratamiento, ncol = 2)

p1a
```

### Porcentaje de Germination

```{r}
trait <- "pg"
fb <- germination

lmm <- paste({{trait}}, "~ 1 + (1|bloque) + tratamiento*variedad") %>% as.formula()

lmd <- paste({{trait}}, "~ bloque + tratamiento*variedad") %>% as.formula()

rmout <- fb %>% 
  remove_outliers(formula = lmm
                  , drop_na = T, plot_diag = T)

rmout$diagplot

rmout$outliers

model <- rmout$data$clean %>% 
  aov(formula = lmd, .)

anova(model)

mc <- emmeans(model, ~ variedad|tratamiento) %>%
  cld(Letters = letters, reversed = T) %>%
  mutate(across(.group, trimws)) %>% 
  rename(group = ".group")

mc %>% kable()

p1b <- mc %>% 
  plot_smr(type = "bar"
           , x = "tratamiento"
           , y = "emmean"
           , group = "variedad"
           , sig = "group"
           , error = "SE"
           , color = T
           , ylab = "Germinación ('%')"
           , xlab = "Tratamientos"
           , ylimits = c(0, 120, 20)
           ) 

p1b
```

### Velocidad de germinación

```{r}
trait <- "vg"
fb <- germination

lmm <- paste({{trait}}, "~ 1 + (1|bloque) + tratamiento*variedad") %>% as.formula()

lmd <- paste({{trait}}, "~ bloque + tratamiento*variedad") %>% as.formula()

rmout <- fb %>% 
  remove_outliers(formula = lmm
                  , drop_na = T, plot_diag = T)

rmout$diagplot

rmout$outliers

model <- rmout$data$clean %>% 
  aov(formula = lmd, .)

anova(model)

mc <- emmeans(model, ~ variedad|tratamiento) %>%
  cld(Letters = letters, reversed = T) %>%
  mutate(across(.group, trimws)) %>% 
  rename(group = ".group")

mc %>% kable()

p1c <- mc %>% 
  plot_smr(type = "bar"
           , x = "tratamiento"
           , y = "emmean"
           , group = "variedad"
           , sig = "group"
           , error = "SE"
           , color = T
           , ylab = "Velocidad de germinación (días)"
           , xlab = "Tratamientos"
           , ylimits = c(0, 6, 1)
           ) 

p1c
```

### Indice de germinación

```{r}
trait <- "ig"
fb <- germination

lmm <- paste({{trait}}, "~ 1 + (1|bloque) + tratamiento*variedad") %>% as.formula()

lmd <- paste({{trait}}, "~ bloque + tratamiento*variedad") %>% as.formula()

rmout <- fb %>% 
  remove_outliers(formula = lmm
                  , drop_na = T, plot_diag = T)

rmout$diagplot

rmout$outliers

model <- rmout$data$clean %>% 
  aov(formula = lmd, .)

anova(model)

mc <- emmeans(model, ~ variedad|tratamiento) %>%
  cld(Letters = letters, reversed = T) %>%
  mutate(across(.group, trimws)) %>% 
  rename(group = ".group")

mc %>% kable()

p1d <- mc %>% 
  plot_smr(type = "bar"
           , x = "tratamiento"
           , y = "emmean"
           , group = "variedad"
           , sig = "group"
           , error = "SE"
           , color = T
           , ylab = "Indice de germinación"
           , xlab = "Tratamientos"
           , ylimits = c(0, 5, 1)
           ) 

p1d
```

## Figura 1

```{r}
legend <- cowplot::get_plot_component(p1b, 'guide-box-top', return_all = TRUE)

p1i <- list(p1b + labs(x = NULL) + theme(legend.position="none"
                                        , axis.title.x=element_blank()
                                        , axis.text.x=element_blank()
                                        , axis.ticks.x=element_blank())
           , p1c + labs(x = NULL) + theme(legend.position="none"
                                        , axis.title.x=element_blank()
                                        , axis.text.x=element_blank()
                                        , axis.ticks.x=element_blank())
           , p1d + labs(x = NULL) + theme(legend.position="none")
           ) %>% 
  plot_grid(plotlist = ., ncol = 1
            , labels = c("b", "c", "d")
            ) 

p1il <- list(legend, p1i) %>% 
  plot_grid(plotlist = ., ncol = 1, align = 'v', rel_heights = c(0.05, 1))


list(p1a, p1il) %>% 
  plot_grid(plotlist = ., ncol = 2, rel_widths = c(1.2, 1.8), labels = c("a")) %>% 
  ggsave2(plot = ., "files/Fig-1.jpg"
         , units = "cm"
         , width = 40
         , height = 25
         )

knitr::include_graphics("files/Fig-1.jpg")
```




